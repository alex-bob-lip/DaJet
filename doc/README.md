# Подсистема DaJet Exchange для 1С

Для интеграции решений, реализованных на платформе 1С:Предприятие 8, с внешними информационными системами
разработана небольшая подсистема DaJet Exchange. Идея заключается в том, что внешняя ИС получает
возможность управлять регистрацией изменений в 1С при помощи файла настроек в формате JSON.

**1. Установка**

- Объединить конфигурацию DaJetExchange.cf с интегрируемой конфигурацией 1С.
- Указать в константе DaJetExchangeCatalog путь к каталогу файла настроек dajet-exchange-settings.json.
- Загрузить файл настроек dajet-exchange-settings.json в константу DaJetExchangeSettings при помощи обработки DaJetExchangeTest.
- Включить использование подсистемы DaJetExchange при помощи константы UseDaJetExchange.

**2. Файл настроек dajet-exchange-settings.json**

Файл имеет интуитивно понятную структуру. Для того, чтобы 1С регистрировала изменения по интересующим внешнюю ИС объектам,
необходимо настроить раздел файла настроек ChangeTracking. Пример настроечного файла прилагается.
При помощи этого файла можно настроить регистрацию изменений для справочников, документов, их табличных частей,
регистров сведений и накопления. Гранулярность регистрации изменений можно настраивать на уровне объектов и их свойств.
Если объект или его свойства не указаны, то по ним регистрация изменений не выполняется.

**3. Очередь исходящих сообщений**

Регистрируемые изменения фиксируются в справочнике DaJetExchangeQueue. Этот справочник выполняет роль очереди исходящих сообщений.
Изменения попадают в эту очередь в виде JSON. Все изменения попадают в справочник DaJetExchangeQueue в транзакции СУБД.
То есть если изменение объекта 1С будет отменено, то регистрация изменения, сообщение для внешней системы, не будет зафиксировано.

Справочник имеет следующую структуру:
- **Код** - счётчик сообщений по порядку, генерируется платформой 1С.
- **ДатаВремя** - дата и время регистрации сообщения.
- **ТипОперации** - перечисление строковых значений: INSERT, UPDATE и DELETE.
- **ТипСообщения** - тип объекта 1С, который содержится в сообщении, например, "Документ.ЗаказКлиента".
- **ТелоСообщения** - данные объекта 1С, сериализованные в формате JSON.

Получать данные из этоё очереди можно при помощи прямых запросов SQL к таблице справочника или при помощи адаптера,
например, для очередей сообщений RabbitMQ или Kafka.